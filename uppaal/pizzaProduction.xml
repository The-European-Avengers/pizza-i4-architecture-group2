<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>// Global declarations:
int[0,100] temp = 0;
int[-20, 0] freezer_temp = 0;

const int WAREHOUSE_VOLUME = 25;
int[0, WAREHOUSE_VOLUME] dough_warehouse = WAREHOUSE_VOLUME;
int[0, WAREHOUSE_VOLUME] sauce_warehouse = WAREHOUSE_VOLUME;
int[0, WAREHOUSE_VOLUME] meat_warehouse = WAREHOUSE_VOLUME;
int[0, WAREHOUSE_VOLUME] cheese_warehouse = WAREHOUSE_VOLUME;
int[0, WAREHOUSE_VOLUME] veg_warehouse = WAREHOUSE_VOLUME;

const int STOCK_VOLUME = 5;
int[0, STOCK_VOLUME] dough_stock = STOCK_VOLUME;
int[0, STOCK_VOLUME] sauce_stock = STOCK_VOLUME;
int[0, STOCK_VOLUME] meat_stock = STOCK_VOLUME;
int[0, STOCK_VOLUME] cheese_stock = STOCK_VOLUME;
int[0, STOCK_VOLUME] veg_stock = STOCK_VOLUME;

const int WAREHOUSE_LIMIT = 5; // limit for the warehouse, after which it requires to be filled with new goods


bool isOn = false;
bool order_done = false;
bool noMeatPizza=false;
bool vegetableStock=true, noVegetablePizza=false, isOven=true;
int stock_level;
const int TARGET_TEMP = 100;
const int FREEZE_TEMP = -18;
const int LOW_STOCK_THRESHOLD = 20;
broadcast chan turn_on;
broadcast chan ovenMachine, freezerMachine;
chan turn_off, oven_ready, pizza_ready;

const int MAX_ORDERS_IN_SYSTEM = 3; // Or any total number you want
int[0,3] pizzas_in_production = 0;

const int MAX_PIZZA_BUFFER = 2; // Max pizzas in any buffer
int[0,2] raw_dough_buffer_count = 0; // DoughMachine -&gt; DoughShaper
int[0,2] dough_buffer_count = 0;     // DoughShaper -&gt; Sauce
int[0,2] sauce_buffer_count = 0;     // Sauce -&gt; Cheese
int[0,2] cheese_buffer_count = 0;    // Cheese -&gt; Meat
int[0,2] meat_buffer_count = 0;      // Meat -&gt; Veg
int[0,2] oven_buffer_count = 0;      // Veg -&gt; Oven
int[0,2] freezer_buffer_count = 0;   // Veg -&gt; Freezer

chan pizza_in, pizza_out;
chan packaging_event, supply_event;
chan door_open, door_closed, pizza_positioned;
chan freeze_complete, pizza_removed;
chan goods_events_provide, goods_events_pickup;
chan check_stock_level, low_stock_detected;
chan restock_events_need, message_received, create_order;
chan pizza_request;

chan requestVegetable, sentVegetable;
chan requestSauce, sentSauce;
chan sentMeat, requestMeat;
chan grateCheese, requestCheese, sentCheese;

// Restock channels:
chan get_dough, provide_dough, dough_from_warehouse, restock_dough, order_dough, dough_arrived;
chan get_sauce, provide_sauce, sauce_from_warehouse, restock_sauce, order_sauce, sauce_arrived;
chan get_cheese, provide_cheese, cheese_from_warehouse, restock_cheese, order_cheese, cheese_arrived;
chan get_meat, provide_meat, meat_from_warehouse, restock_meat, order_meat, meat_arrived;
chan get_veg, provide_veg, veg_from_warehouse, restock_veg, order_veg, veg_arrived;

</declaration>
	<template>
		<name>Customer</name>
		<declaration>clock t;
void ovenOrFreezer(){
    if(isOven == true){
        isOven=false;
    }
    else{
        isOven=true;
    }
}
</declaration>
		<location id="id0" x="162" y="-24072">
			<name x="161" y="-24106">idle</name>
		</location>
		<location id="id1" x="374" y="-24250">
			<name x="366" y="-24284">turnOnMachines</name>
		</location>
		<init ref="id0"/>
		<transition id="id2">
			<source ref="id0"/>
			<target ref="id0"/>
			<label kind="guard" x="102" y="-23893">isOn &amp;&amp; 
t&gt;=10 &amp;&amp; 
pizzas_in_production &lt; MAX_ORDERS_IN_SYSTEM</label>
			<label kind="synchronisation" x="102" y="-23961">pizza_request!</label>
			<label kind="assignment" x="102" y="-23936">t=0, ovenOrFreezer(),
pizzas_in_production++</label>
			<nail x="229" y="-23978"/>
			<nail x="102" y="-23978"/>
		</transition>
		<transition id="id3">
			<source ref="id1"/>
			<target ref="id0"/>
			<label kind="guard" x="297" y="-24063">pizzas_in_production &lt; MAX_ORDERS_IN_SYSTEM</label>
			<label kind="synchronisation" x="391" y="-24174">pizza_request!</label>
			<label kind="assignment" x="297" y="-24046">t=0, pizzas_in_production++</label>
			<nail x="389" y="-24121"/>
			<nail x="338" y="-24078"/>
		</transition>
		<transition id="id4">
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="guard" x="111" y="-24293">!isOn</label>
			<label kind="synchronisation" x="111" y="-24259">turn_on!</label>
			<label kind="assignment" x="111" y="-24276">isOn=true</label>
			<nail x="145" y="-24199"/>
			<nail x="230" y="-24276"/>
		</transition>
	</template>
	<template>
		<name>InternalGoodsProvider</name>
		<declaration>// Place local declarations here.
clock t;</declaration>
		<location id="id5" x="-416" y="0">
			<name x="-433" y="-34">idle</name>
		</location>
		<location id="id6" x="-799" y="195">
			<name x="-850" y="212">pickupPizza</name>
			<label kind="invariant" x="-850" y="229">t&lt;=2</label>
		</location>
		<location id="id7" x="-586" y="-76">
			<name x="-629" y="-110">requestDough</name>
		</location>
		<location id="id8" x="-748" y="-42">
			<name x="-926" y="-76">requestWarehouse4Dough</name>
		</location>
		<location id="id9" x="-595" y="34">
			<name x="-671" y="42">provideDough</name>
		</location>
		<location id="id10" x="-450" y="-144">
			<name x="-544" y="-178">requestSauce</name>
		</location>
		<location id="id11" x="-357" y="-263">
			<name x="-365" y="-297">requestWareHouse4Sauce</name>
		</location>
		<location id="id12" x="-297" y="-127">
			<name x="-280" y="-136">provideSauce</name>
		</location>
		<location id="id13" x="-25" y="-51">
			<name x="-35" y="-85">requestWareHouse4Meat</name>
		</location>
		<location id="id14" x="-178" y="25">
			<name x="-170" y="34">provideMeat</name>
		</location>
		<location id="id15" x="-221" y="-85">
			<name x="-272" y="-68">requestMeat</name>
		</location>
		<location id="id16" x="-178" y="212">
			<name x="-229" y="229">requestWarehouse4Cheese</name>
		</location>
		<location id="id17" x="-331" y="136">
			<name x="-382" y="153">provideCheese</name>
		</location>
		<location id="id18" x="-204" y="85">
			<name x="-179" y="93">requestCheese</name>
		</location>
		<location id="id19" x="-408" y="144">
			<name x="-476" y="153">requestVeg</name>
		</location>
		<location id="id20" x="-527" y="110">
			<name x="-586" y="127">provideVeg</name>
		</location>
		<location id="id21" x="-518" y="221">
			<name x="-569" y="229">requestWarehouse4Veg</name>
		</location>
		<init ref="id5"/>
		<transition id="id22">
			<source ref="id20"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="-535" y="68">provide_veg!</label>
		</transition>
		<transition id="id23">
			<source ref="id21"/>
			<target ref="id20"/>
			<label kind="synchronisation" x="-629" y="161">restock_veg?</label>
		</transition>
		<transition id="id24">
			<source ref="id19"/>
			<target ref="id21"/>
			<label kind="synchronisation" x="-510" y="178">veg_from_warehouse!</label>
		</transition>
		<transition id="id25">
			<source ref="id5"/>
			<target ref="id19"/>
			<label kind="synchronisation" x="-459" y="51">get_veg?</label>
		</transition>
		<transition id="id26">
			<source ref="id14"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="-323" y="-8">provide_meat!</label>
		</transition>
		<transition id="id27">
			<source ref="id17"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="-399" y="76">provide_cheese!</label>
		</transition>
		<transition id="id28">
			<source ref="id5"/>
			<target ref="id18"/>
			<label kind="synchronisation" x="-340" y="34">get_cheese?</label>
		</transition>
		<transition id="id29">
			<source ref="id5"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="-340" y="-51">get_meat?</label>
		</transition>
		<transition id="id30">
			<source ref="id12"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="-382" y="-93">provide_sauce!</label>
		</transition>
		<transition id="id31">
			<source ref="id11"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="-327" y="-212">restock_sauce?</label>
		</transition>
		<transition id="id32">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-535" y="-221">sauce_from_warehouse!</label>
		</transition>
		<transition id="id33">
			<source ref="id5"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-467" y="-110">get_sauce?</label>
		</transition>
		<transition id="id34">
			<source ref="id9"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="-586" y="-8">provide_dough!</label>
		</transition>
		<transition id="id35">
			<source ref="id8"/>
			<target ref="id9"/>
			<label kind="synchronisation" x="-782" y="0">restock_dough?</label>
		</transition>
		<transition id="id36">
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="synchronisation" x="-790" y="-93">dough_from_warehouse!</label>
		</transition>
		<transition id="id37">
			<source ref="id5"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="-535" y="-76">get_dough?</label>
		</transition>
		<transition id="id38">
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="-756" y="195">goods_events_pickup?</label>
			<label kind="assignment" x="-722" y="178">t=0</label>
			<nail x="-671" y="170"/>
		</transition>
		<transition id="id39">
			<source ref="id6"/>
			<target ref="id5"/>
			<label kind="guard" x="-790" y="110">t&gt;=2</label>
			<nail x="-722" y="110"/>
		</transition>
		<transition id="id40">
			<source ref="id13"/>
			<target ref="id14"/>
			<label kind="synchronisation" x="-93" y="-17">restock_meat?</label>
		</transition>
		<transition id="id41">
			<source ref="id15"/>
			<target ref="id13"/>
			<label kind="synchronisation" x="-187" y="-102">meat_from_warehouse!</label>
		</transition>
		<transition id="id42">
			<source ref="id16"/>
			<target ref="id17"/>
			<label kind="synchronisation" x="-348" y="187">restock_cheese?</label>
		</transition>
		<transition id="id43">
			<source ref="id18"/>
			<target ref="id16"/>
			<label kind="synchronisation" x="-229" y="119">cheese_from_warehouse!</label>
		</transition>
	</template>
	<template>
		<name>InventoryManager</name>
		<declaration>// Place local declarations here.
clock t;</declaration>
		<location id="id44" x="-340" y="0">
			<name x="-391" y="25">monitoring</name>
		</location>
		<location id="id45" x="17" y="68">
			<name x="7" y="34">dough</name>
		</location>
		<location id="id46" x="-501" y="-238">
			<name x="-560" y="-272">sauce</name>
		</location>
		<location id="id47" x="-501" y="-442">
			<name x="-552" y="-485">requestSauce</name>
		</location>
		<location id="id48" x="-170" y="-442">
			<name x="-154" y="-442">restockSauce</name>
		</location>
		<location id="id49" x="136" y="170">
			<name x="144" y="178">requestDough</name>
		</location>
		<location id="id50" x="-51" y="331">
			<name x="-67" y="340">restockDough</name>
		</location>
		<location id="id51" x="-841" y="110">
			<name x="-841" y="118">meat</name>
		</location>
		<location id="id52" x="-637" y="-127">
			<name x="-739" y="-119">restockMeat</name>
		</location>
		<location id="id53" x="-884" y="-136">
			<name x="-943" y="-119">requestMeat</name>
		</location>
		<location id="id54" x="-357" y="416">
			<name x="-367" y="382">cheese</name>
		</location>
		<location id="id55" x="-561" y="204">
			<name x="-671" y="213">restockCheese</name>
		</location>
		<location id="id56" x="-697" y="348">
			<name x="-689" y="356">requestCheese</name>
		</location>
		<location id="id57" x="-136" y="-204">
			<name x="-146" y="-238">veg</name>
		</location>
		<location id="id58" x="195" y="-93">
			<name x="178" y="-84">restockVeg</name>
		</location>
		<location id="id59" x="153" y="-323">
			<name x="161" y="-315">requestVeg</name>
		</location>
		<init ref="id44"/>
		<transition id="id60">
			<source ref="id58"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="-68" y="-76">restock_veg!</label>
			<label kind="assignment" x="-68" y="-59">veg_stock=STOCK_VOLUME,
veg_warehouse-=STOCK_VOLUME</label>
		</transition>
		<transition id="id61">
			<source ref="id44"/>
			<target ref="id57"/>
			<label kind="synchronisation" x="-280" y="-93">veg_from_warehouse?</label>
		</transition>
		<transition id="id62">
			<source ref="id55"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="-518" y="119">restock_cheese!</label>
			<label kind="assignment" x="-518" y="136">cheese_stock=STOCK_VOLUME,
cheese_warehouse-=STOCK_VOLUME</label>
		</transition>
		<transition id="id63">
			<source ref="id44"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="-374" y="187">cheese_from_warehouse?</label>
		</transition>
		<transition id="id64">
			<source ref="id52"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="-595" y="-119">restock_meat!</label>
			<label kind="assignment" x="-595" y="-102">meat_stock=STOCK_VOLUME,
meat_warehouse-=STOCK_VOLUME</label>
		</transition>
		<transition id="id65">
			<source ref="id44"/>
			<target ref="id51"/>
			<label kind="synchronisation" x="-543" y="55">meat_from_warehouse?</label>
		</transition>
		<transition id="id66">
			<source ref="id45"/>
			<target ref="id50"/>
			<label kind="guard" x="-102" y="119">dough_warehouse &gt; WAREHOUSE_LIMIT</label>
		</transition>
		<transition id="id67">
			<source ref="id50"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="-280" y="59">restock_dough!</label>
			<label kind="assignment" x="-280" y="76">dough_stock=STOCK_VOLUME,
dough_warehouse-=STOCK_VOLUME</label>
		</transition>
		<transition id="id68">
			<source ref="id49"/>
			<target ref="id50"/>
			<label kind="synchronisation" x="26" y="182">dough_arrived?</label>
			<label kind="assignment" x="26" y="199">dough_warehouse=WAREHOUSE_VOLUME</label>
		</transition>
		<transition id="id69">
			<source ref="id45"/>
			<target ref="id49"/>
			<label kind="guard" x="35" y="85">dough_warehouse&lt;=WAREHOUSE_LIMIT</label>
			<label kind="synchronisation" x="35" y="102">order_dough!</label>
		</transition>
		<transition id="id70">
			<source ref="id46"/>
			<target ref="id48"/>
			<label kind="guard" x="-476" y="-391">sauce_warehouse &gt; WAREHOUSE_LIMIT</label>
		</transition>
		<transition id="id71">
			<source ref="id48"/>
			<target ref="id44"/>
			<label kind="synchronisation" x="-365" y="-289">restock_sauce!</label>
			<label kind="assignment" x="-365" y="-272">sauce_stock=STOCK_VOLUME,
sauce_warehouse-=STOCK_VOLUME</label>
		</transition>
		<transition id="id72">
			<source ref="id47"/>
			<target ref="id48"/>
			<label kind="synchronisation" x="-442" y="-493">sauce_arrived?</label>
			<label kind="assignment" x="-442" y="-476">sauce_warehouse=WAREHOUSE_VOLUME</label>
		</transition>
		<transition id="id73">
			<source ref="id46"/>
			<target ref="id47"/>
			<label kind="guard" x="-705" y="-357">sauce_warehouse&lt;=WAREHOUSE_LIMIT</label>
			<label kind="synchronisation" x="-705" y="-340">order_sauce!</label>
		</transition>
		<transition id="id74">
			<source ref="id44"/>
			<target ref="id46"/>
			<label kind="synchronisation" x="-586" y="-178">sauce_from_warehouse?</label>
		</transition>
		<transition id="id75">
			<source ref="id44"/>
			<target ref="id45"/>
			<label kind="synchronisation" x="-204" y="8">dough_from_warehouse?</label>
		</transition>
		<transition id="id76">
			<source ref="id51"/>
			<target ref="id52"/>
			<label kind="guard" x="-680" y="-25">meat_warehouse &gt; WAREHOUSE_LIMIT</label>
		</transition>
		<transition id="id77">
			<source ref="id53"/>
			<target ref="id52"/>
			<label kind="synchronisation" x="-909" y="-85">meat_arrived?</label>
			<label kind="assignment" x="-977" y="-68">meat_warehouse=WAREHOUSE_VOLUME</label>
		</transition>
		<transition id="id78">
			<source ref="id51"/>
			<target ref="id53"/>
			<label kind="guard" x="-841" y="93">meat_warehouse&lt;=WAREHOUSE_LIMIT</label>
			<label kind="synchronisation" x="-841" y="110">order_meat!</label>
		</transition>
		<transition id="id79">
			<source ref="id54"/>
			<target ref="id55"/>
			<label kind="guard" x="-510" y="221">cheese_warehouse &gt; 
WAREHOUSE_LIMIT</label>
		</transition>
		<transition id="id80">
			<source ref="id56"/>
			<target ref="id55"/>
			<label kind="synchronisation" x="-731" y="263">cheese_arrived?</label>
			<label kind="assignment" x="-731" y="280">cheese_warehouse=WAREHOUSE_VOLUME</label>
		</transition>
		<transition id="id81">
			<source ref="id54"/>
			<target ref="id56"/>
			<label kind="guard" x="-501" y="331">cheese_warehouse&lt;=WAREHOUSE_LIMIT</label>
			<label kind="synchronisation" x="-501" y="348">order_cheese!</label>
		</transition>
		<transition id="id82">
			<source ref="id57"/>
			<target ref="id58"/>
			<label kind="guard" x="-76" y="-153">veg_warehouse &gt; WAREHOUSE_LIMIT</label>
		</transition>
		<transition id="id83">
			<source ref="id59"/>
			<target ref="id58"/>
			<label kind="synchronisation" x="238" y="-229">veg_arrived?</label>
			<label kind="assignment" x="238" y="-212">veg_warehouse=WAREHOUSE_VOLUME</label>
		</transition>
		<transition id="id84">
			<source ref="id57"/>
			<target ref="id59"/>
			<label kind="guard" x="-68" y="-272">veg_warehouse&lt;=WAREHOUSE_LIMIT</label>
			<label kind="synchronisation" x="-68" y="-255">order_veg!</label>
		</transition>
	</template>
	<template>
		<name>RestockingHandler</name>
		<declaration>// Place local declarations here.
clock t;</declaration>
		<location id="id85" x="-365" y="0">
			<name x="-348" y="-25">idle</name>
		</location>
		<location id="id86" x="-93" y="-76">
			<name x="-110" y="-110">ordering</name>
		</location>
		<location id="id87" x="-348" y="-178">
			<name x="-358" y="-212">dough</name>
		</location>
		<location id="id88" x="-586" y="-68">
			<name x="-620" y="-51">sauce</name>
		</location>
		<location id="id89" x="-586" y="68">
			<name x="-603" y="85">meat</name>
		</location>
		<location id="id90" x="-408" y="161">
			<name x="-425" y="178">cheese</name>
		</location>
		<location id="id91" x="-195" y="85">
			<name x="-195" y="93">veg</name>
		</location>
		<init ref="id85"/>
		<transition id="id92">
			<source ref="id91"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-340" y="34">veg_arrived!</label>
			<nail x="-289" y="59"/>
		</transition>
		<transition id="id93">
			<source ref="id85"/>
			<target ref="id91"/>
			<label kind="synchronisation" x="-238" y="8">order_veg?</label>
			<nail x="-263" y="8"/>
		</transition>
		<transition id="id94">
			<source ref="id90"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-391" y="76">cheese_arrived!</label>
			<nail x="-348" y="76"/>
		</transition>
		<transition id="id95">
			<source ref="id85"/>
			<target ref="id90"/>
			<label kind="synchronisation" x="-493" y="102">order_cheese?</label>
			<nail x="-408" y="59"/>
		</transition>
		<transition id="id96">
			<source ref="id89"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-544" y="76">meat_arrived!</label>
			<nail x="-467" y="76"/>
		</transition>
		<transition id="id97">
			<source ref="id85"/>
			<target ref="id89"/>
			<label kind="synchronisation" x="-612" y="17">order_meat?</label>
			<nail x="-493" y="17"/>
		</transition>
		<transition id="id98">
			<source ref="id88"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-569" y="-34">sauce_arrived!</label>
			<nail x="-484" y="-8"/>
		</transition>
		<transition id="id99">
			<source ref="id85"/>
			<target ref="id88"/>
			<label kind="synchronisation" x="-552" y="-93">order_sauce?</label>
			<nail x="-467" y="-68"/>
		</transition>
		<transition id="id100">
			<source ref="id87"/>
			<target ref="id85"/>
			<label kind="synchronisation" x="-349" y="-102">dough_arrived!</label>
			<nail x="-323" y="-102"/>
		</transition>
		<transition id="id101">
			<source ref="id85"/>
			<target ref="id87"/>
			<label kind="synchronisation" x="-442" y="-127">order_dough?</label>
			<nail x="-391" y="-102"/>
		</transition>
		<transition id="id102">
			<source ref="id85"/>
			<target ref="id86"/>
			<label kind="assignment" x="-195" y="-102">t=0</label>
			<nail x="-221" y="-85"/>
		</transition>
		<transition id="id103">
			<source ref="id86"/>
			<target ref="id85"/>
			<label kind="guard" x="-144" y="-42">t&gt;=2</label>
			<label kind="assignment" x="-144" y="-25">t=0</label>
			<nail x="-187" y="-25"/>
		</transition>
	</template>
	<template>
		<name>Freezer</name>
		<declaration>// Place local declarations here.

clock t;</declaration>
		<location id="id104" x="-1037" y="0">
			<name x="-1071" y="-34">idle</name>
		</location>
		<location id="id105" x="-816" y="0">
			<name x="-859" y="-34">precooling</name>
			<label kind="invariant" x="-841" y="17">t&lt;=5</label>
		</location>
		<location id="id106" x="-510" y="0">
			<name x="-501" y="-34">waiting</name>
		</location>
		<location id="id107" x="-144" y="0">
			<name x="-161" y="-34">freeze</name>
		</location>
		<init ref="id104"/>
		<transition id="id108">
			<source ref="id107"/>
			<target ref="id106"/>
			<label kind="guard" x="-374" y="102">t&gt;=10</label>
			<label kind="synchronisation" x="-374" y="119">pizza_out!</label>
			<label kind="assignment" x="-374" y="136">t=0</label>
			<nail x="-246" y="93"/>
			<nail x="-442" y="93"/>
		</transition>
		<transition id="id109">
			<source ref="id104"/>
			<target ref="id105"/>
			<label kind="synchronisation" x="-994" y="-59">turn_on?</label>
			<label kind="assignment" x="-994" y="-42">t=0,
freezer_temp=0</label>
		</transition>
		<transition id="id110">
			<source ref="id105"/>
			<target ref="id106"/>
			<label kind="guard" x="-756" y="-59">t&gt;=5</label>
			<label kind="assignment" x="-756" y="-42">freezer_temp=FREEZE_TEMP,
t=0</label>
		</transition>
		<transition id="id111">
			<source ref="id106"/>
			<target ref="id107"/>
			<label kind="guard" x="-416" y="-68">freezer_temp&gt;=FREEZE_TEMP &amp;&amp;
freezer_buffer_count &gt; 0</label>
			<label kind="assignment" x="-416" y="-34">t=0, freezer_buffer_count--</label>
		</transition>
		<transition id="id112">
			<source ref="id106"/>
			<target ref="id104"/>
			<label kind="synchronisation" x="-833" y="-204">turn_off?</label>
			<label kind="assignment" x="-833" y="-187">freezer_temp=0</label>
			<nail x="-510" y="-161"/>
			<nail x="-1037" y="-161"/>
		</transition>
	</template>
	<template>
		<name>PackagingRobot</name>
		<declaration>// Place local declarations here.
clock t;</declaration>
		<location id="id113" x="-680" y="-85">
			<name x="-722" y="-119">idle</name>
		</location>
		<location id="id114" x="-510" y="-85">
			<name x="-501" y="-119">waiting</name>
		</location>
		<location id="id115" x="-280" y="-85">
			<name x="-297" y="-119">operatePizza</name>
		</location>
		<init ref="id113"/>
		<transition id="id116">
			<source ref="id115"/>
			<target ref="id114"/>
			<label kind="guard" x="-391" y="-34">t&gt;=2</label>
			<label kind="synchronisation" x="-450" y="8">goods_events_pickup!</label>
			<label kind="assignment" x="-450" y="25">pizzas_in_production--</label>
			<nail x="-280" y="-8"/>
			<nail x="-459" y="-8"/>
		</transition>
		<transition id="id117">
			<source ref="id113"/>
			<target ref="id114"/>
			<label kind="synchronisation" x="-637" y="-127">turn_on?</label>
			<label kind="assignment" x="-637" y="-110">t=0</label>
		</transition>
		<transition id="id118">
			<source ref="id114"/>
			<target ref="id113"/>
			<label kind="synchronisation" x="-654" y="-212">turn_off?</label>
			<label kind="assignment" x="-654" y="-195">t=0</label>
			<nail x="-510" y="-178"/>
			<nail x="-680" y="-178"/>
		</transition>
		<transition id="id119">
			<source ref="id114"/>
			<target ref="id115"/>
			<label kind="synchronisation" x="-391" y="-119">pizza_out?</label>
			<label kind="assignment" x="-391" y="-102">t=0</label>
		</transition>
	</template>
	<template>
		<name>Oven</name>
		<declaration>// Place local declarations here.
clock t;</declaration>
		<location id="id120" x="-595" y="-153">
			<name x="-612" y="-187">idle</name>
		</location>
		<location id="id121" x="-255" y="-153">
			<name x="-289" y="-186">preheating</name>
			<label kind="invariant" x="-306" y="-144">t&lt;=2</label>
		</location>
		<location id="id122" x="59" y="-153">
			<name x="-8" y="-187">waiting</name>
		</location>
		<location id="id123" x="68" y="68">
			<name x="51" y="85">baking</name>
		</location>
		<init ref="id120"/>
		<transition id="id124">
			<source ref="id120"/>
			<target ref="id121"/>
			<label kind="synchronisation" x="-467" y="-212">turn_on?</label>
			<label kind="assignment" x="-467" y="-195">t=0,
temp=0</label>
		</transition>
		<transition id="id125">
			<source ref="id121"/>
			<target ref="id122"/>
			<label kind="guard" x="-161" y="-229">t&gt;=2</label>
			<label kind="assignment" x="-161" y="-195">temp=TARGET_TEMP,
t=0</label>
		</transition>
		<transition id="id126">
			<source ref="id121"/>
			<target ref="id120"/>
			<label kind="synchronisation" x="-425" y="-331">turn_off?</label>
			<label kind="assignment" x="-425" y="-314">temp=0, t=0</label>
			<nail x="-255" y="-280"/>
			<nail x="-459" y="-280"/>
		</transition>
		<transition id="id127">
			<source ref="id122"/>
			<target ref="id120"/>
			<label kind="synchronisation" x="-459" y="-59">turn_off?</label>
			<label kind="assignment" x="-459" y="-42">t=0, temp=0</label>
			<nail x="-77" y="-68"/>
			<nail x="-290" y="-8"/>
			<nail x="-520" y="-9"/>
			<nail x="-579" y="-119"/>
		</transition>
		<transition id="id128">
			<source ref="id122"/>
			<target ref="id123"/>
			<label kind="guard" x="127" y="-59">temp&gt;=TARGET_TEMP &amp;&amp; 
oven_buffer_count &gt; 0</label>
			<label kind="assignment" x="127" y="-17">t=0, oven_buffer_count--</label>
			<nail x="110" y="-42"/>
		</transition>
		<transition id="id129">
			<source ref="id123"/>
			<target ref="id122"/>
			<label kind="guard" x="-51" y="-17">t&gt;=3</label>
			<label kind="synchronisation" x="-51" y="0">pizza_out!</label>
			<label kind="assignment" x="-51" y="17">t=0</label>
			<nail x="17" y="-42"/>
		</transition>
	</template>
	<template>
		<name x="5" y="5">DoughMachine</name>
		<declaration>// Place local declarations here.
clock t;</declaration>
		<location id="id130" x="0" y="-42">
			<name x="-17" y="-76">idle</name>
		</location>
		<location id="id131" x="170" y="34">
			<name x="153" y="51">dispatch</name>
		</location>
		<location id="id132" x="170" y="-127">
			<name x="85" y="-161">checkStock</name>
		</location>
		<location id="id133" x="535" y="-127">
			<name x="525" y="-161">restock</name>
		</location>
		<location id="id134" x="544" y="34">
			<name x="544" y="51">restocked</name>
		</location>
		<location id="id135" x="374" y="34">
			<name x="357" y="51">kneading</name>
		</location>
		<init ref="id130"/>
		<transition id="id136">
			<source ref="id134"/>
			<target ref="id135"/>
			<label kind="synchronisation" x="408" y="8">provide_dough?</label>
		</transition>
		<transition id="id137">
			<source ref="id135"/>
			<target ref="id131"/>
			<label kind="assignment" x="212" y="-8">t=0, 
dough_stock--</label>
		</transition>
		<transition id="id138">
			<source ref="id132"/>
			<target ref="id135"/>
			<label kind="guard" x="289" y="-68">dough_stock&gt;0</label>
		</transition>
		<transition id="id139">
			<source ref="id133"/>
			<target ref="id134"/>
			<label kind="synchronisation" x="544" y="-59">get_dough!</label>
		</transition>
		<transition id="id140">
			<source ref="id132"/>
			<target ref="id133"/>
			<label kind="guard" x="238" y="-153">dough_stock&lt;=0</label>
		</transition>
		<transition id="id141">
			<source ref="id130"/>
			<target ref="id132"/>
			<label kind="synchronisation" x="-25" y="-119">pizza_request?</label>
		</transition>
		<transition id="id142">
			<source ref="id131"/>
			<target ref="id130"/>
			<label kind="guard" x="-221" y="0">t &gt;= 2 &amp;&amp; 
raw_dough_buffer_count &lt; MAX_PIZZA_BUFFER</label>
			<label kind="assignment" x="-221" y="42">raw_dough_buffer_count++</label>
		</transition>
	</template>
	<template>
		<name>SauceMachine</name>
		<declaration>clock t;
</declaration>
		<location id="id143" x="-510" y="-178">
			<name x="-535" y="-212">idle</name>
		</location>
		<location id="id144" x="-195" y="-289">
			<name x="-246" y="-323">checkStock</name>
		</location>
		<location id="id145" x="-195" y="-59">
			<name x="-229" y="-42">dispatch</name>
		</location>
		<location id="id146" x="136" y="-289">
			<name x="126" y="-323">restock</name>
		</location>
		<location id="id147" x="136" y="-59">
			<name x="111" y="-42">restocked</name>
		</location>
		<location id="id148" x="-25" y="-59">
			<name x="-51" y="-42">addToPizza</name>
		</location>
		<init ref="id143"/>
		<transition id="id149">
			<source ref="id144"/>
			<target ref="id148"/>
			<label kind="guard" x="-110" y="-195">sauce_stock &gt; 0</label>
		</transition>
		<transition id="id150">
			<source ref="id148"/>
			<target ref="id145"/>
			<label kind="assignment" x="-170" y="-102">t=0, 
sauce_stock--</label>
		</transition>
		<transition id="id151">
			<source ref="id147"/>
			<target ref="id148"/>
			<label kind="synchronisation" x="0" y="-85">provide_sauce?</label>
		</transition>
		<transition id="id152">
			<source ref="id146"/>
			<target ref="id147"/>
			<label kind="synchronisation" x="153" y="-187">get_sauce!</label>
		</transition>
		<transition id="id153">
			<source ref="id144"/>
			<target ref="id146"/>
			<label kind="guard" x="-136" y="-323">sauce_stock &lt;= 0</label>
		</transition>
		<transition id="id154">
			<source ref="id145"/>
			<target ref="id143"/>
			<label kind="guard" x="-552" y="-93">t&gt;=2 &amp;&amp; 
sauce_buffer_count &lt; MAX_PIZZA_BUFFER</label>
			<label kind="assignment" x="-552" y="-110">sauce_buffer_count++</label>
		</transition>
		<transition id="id155">
			<source ref="id143"/>
			<target ref="id144"/>
			<label kind="guard" x="-493" y="-306">dough_buffer_count &gt; 0</label>
			<label kind="assignment" x="-493" y="-289">t=0,
dough_buffer_count--</label>
		</transition>
	</template>
	<template>
		<name x="5" y="5">DoughShaper</name>
		<declaration>// Place local declarations here.
clock t;</declaration>
		<location id="id156" x="-68" y="-34">
			<name x="-78" y="-68">idle</name>
		</location>
		<location id="id157" x="222" y="-34">
			<name x="212" y="-68">shapingDough</name>
		</location>
		<init ref="id156"/>
		<transition id="id158">
			<source ref="id157"/>
			<target ref="id156"/>
			<label kind="guard" x="-25" y="8">t&gt;=2 &amp;&amp;
dough_buffer_count &lt; MAX_PIZZA_BUFFER</label>
			<label kind="assignment" x="-25" y="50">dough_buffer_count++</label>
			<nail x="76" y="17"/>
		</transition>
		<transition id="id159">
			<source ref="id156"/>
			<target ref="id157"/>
			<label kind="guard" x="-34" y="-136">raw_dough_buffer_count &gt; 0</label>
			<label kind="assignment" x="-34" y="-119">t=0, raw_dough_buffer_count--</label>
			<nail x="76" y="-85"/>
		</transition>
	</template>
	<template>
		<name>MeatSlicer</name>
		<declaration>clock t;
</declaration>
		<location id="id160" x="-416" y="-76">
			<name x="-442" y="-110">idle</name>
		</location>
		<location id="id161" x="-272" y="-204">
			<name x="-315" y="-246">choosingMeat</name>
		</location>
		<location id="id162" x="-51" y="-204">
			<name x="-93" y="-246">checkStock</name>
		</location>
		<location id="id163" x="-272" y="59">
			<name x="-374" y="76">dispatch</name>
		</location>
		<location id="id164" x="153" y="-204">
			<name x="143" y="-238">restock</name>
		</location>
		<location id="id165" x="153" y="59">
			<name x="144" y="76">restocked</name>
		</location>
		<location id="id166" x="-51" y="59">
			<name x="-77" y="76">addToPizza</name>
		</location>
		<init ref="id160"/>
		<transition id="id167">
			<source ref="id166"/>
			<target ref="id163"/>
			<label kind="assignment" x="-229" y="34">t=0, meat_stock--</label>
		</transition>
		<transition id="id168">
			<source ref="id162"/>
			<target ref="id166"/>
			<label kind="guard" x="-42" y="-93">meat_stock &gt; 0</label>
		</transition>
		<transition id="id169">
			<source ref="id165"/>
			<target ref="id166"/>
			<label kind="synchronisation" x="8" y="34">provide_meat?</label>
		</transition>
		<transition id="id170">
			<source ref="id164"/>
			<target ref="id165"/>
			<label kind="synchronisation" x="157" y="-89">get_meat!</label>
		</transition>
		<transition id="id171">
			<source ref="id162"/>
			<target ref="id164"/>
			<label kind="guard" x="0" y="-238">meat_stock&lt;=0</label>
		</transition>
		<transition id="id172">
			<source ref="id161"/>
			<target ref="id163"/>
			<label kind="guard" x="-263" y="-93">noMeatPizza</label>
			<label kind="assignment" x="-263" y="-76">t=0</label>
		</transition>
		<transition id="id173">
			<source ref="id163"/>
			<target ref="id160"/>
			<label kind="guard" x="-620" y="-8">t&gt;=2 &amp;&amp; 
meat_buffer_count &lt; MAX_PIZZA_BUFFER</label>
			<label kind="assignment" x="-620" y="35">meat_buffer_count++</label>
		</transition>
		<transition id="id174">
			<source ref="id161"/>
			<target ref="id162"/>
			<label kind="guard" x="-212" y="-238">!noMeatPizza</label>
		</transition>
		<transition id="id175">
			<source ref="id160"/>
			<target ref="id161"/>
			<label kind="guard" x="-561" y="-195">cheese_buffer_count &gt; 0</label>
			<label kind="assignment" x="-561" y="-170">t=0, cheese_buffer_count--</label>
		</transition>
	</template>
	<template>
		<name>CheeseGrater</name>
		<declaration>clock t;
</declaration>
		<location id="id176" x="-374" y="-42">
			<name x="-399" y="-76">idle</name>
		</location>
		<location id="id177" x="-8" y="-170">
			<name x="-59" y="-204">checkStock</name>
		</location>
		<location id="id178" x="0" y="34">
			<name x="-17" y="51">dispatch</name>
		</location>
		<location id="id179" x="433" y="-170">
			<name x="423" y="-204">restock</name>
		</location>
		<location id="id180" x="442" y="34">
			<name x="425" y="51">restocked</name>
		</location>
		<location id="id181" x="255" y="34">
			<name x="229" y="51">addToPizza</name>
		</location>
		<init ref="id176"/>
		<transition id="id182">
			<source ref="id177"/>
			<target ref="id181"/>
			<label kind="guard" x="119" y="-93">cheese_stock &gt; 0</label>
		</transition>
		<transition id="id183">
			<source ref="id181"/>
			<target ref="id178"/>
			<label kind="assignment" x="59" y="-8">t=0, 
cheese_stock--</label>
		</transition>
		<transition id="id184">
			<source ref="id180"/>
			<target ref="id181"/>
			<label kind="synchronisation" x="297" y="8">provide_cheese?</label>
		</transition>
		<transition id="id185">
			<source ref="id179"/>
			<target ref="id180"/>
			<label kind="synchronisation" x="450" y="-85">get_cheese!</label>
		</transition>
		<transition id="id186">
			<source ref="id177"/>
			<target ref="id179"/>
			<label kind="guard" x="144" y="-195">cheese_stock&lt;=0</label>
		</transition>
		<transition id="id187">
			<source ref="id176"/>
			<target ref="id177"/>
			<label kind="guard" x="-330" y="-177">sauce_buffer_count &gt; 0</label>
			<label kind="assignment" x="-331" y="-153">t=0, 
sauce_buffer_count--</label>
		</transition>
		<transition id="id188">
			<source ref="id178"/>
			<target ref="id176"/>
			<label kind="guard" x="-374" y="8">t&gt;=2 &amp;&amp; 
cheese_buffer_count &lt; MAX_PIZZA_BUFFER</label>
			<label kind="assignment" x="-374" y="51">cheese_buffer_count++</label>
		</transition>
	</template>
	<template>
		<name>VegetablesSlicer</name>
		<declaration>clock t;
</declaration>
		<location id="id189" x="-629" y="-170">
			<name x="-654" y="-204">idle</name>
		</location>
		<location id="id190" x="-212" y="-161">
			<name x="-331" y="-144">choosingVegetable</name>
		</location>
		<location id="id191" x="-212" y="-425">
			<name x="-280" y="-459">dispatchToOven</name>
		</location>
		<location id="id192" x="119" y="-161">
			<name x="127" y="-153">checkStock</name>
		</location>
		<location id="id193" x="-212" y="76">
			<name x="-280" y="118">dispatchToFreezer</name>
		</location>
		<location id="id194" x="119" y="-42">
			<name x="93" y="-34">restock</name>
		</location>
		<location id="id195" x="314" y="-42">
			<name x="288" y="-34">restocked</name>
		</location>
		<location id="id196" x="314" y="-161">
			<name x="323" y="-144">addToPizza</name>
		</location>
		<init ref="id189"/>
		<transition id="id197">
			<source ref="id196"/>
			<target ref="id193"/>
			<label kind="guard" x="59" y="93">t&gt;=2 &amp;&amp; !isOven</label>
			<label kind="assignment" x="59" y="110">t=0,
veg_stock--</label>
			<nail x="467" y="-161"/>
			<nail x="467" y="76"/>
		</transition>
		<transition id="id198">
			<source ref="id196"/>
			<target ref="id191"/>
			<label kind="guard" x="323" y="-357">t&gt;=2 &amp;&amp; isOven</label>
			<label kind="assignment" x="323" y="-340">t=0,
veg_stock--</label>
			<nail x="314" y="-425"/>
		</transition>
		<transition id="id199">
			<source ref="id192"/>
			<target ref="id194"/>
			<label kind="guard" x="85" y="-110">veg_stock&lt;=0</label>
		</transition>
		<transition id="id200">
			<source ref="id192"/>
			<target ref="id196"/>
			<label kind="guard" x="161" y="-187">veg_stock &gt; 0</label>
		</transition>
		<transition id="id201">
			<source ref="id195"/>
			<target ref="id196"/>
			<label kind="synchronisation" x="323" y="-102">provide_veg?</label>
		</transition>
		<transition id="id202">
			<source ref="id194"/>
			<target ref="id195"/>
			<label kind="synchronisation" x="187" y="-34">get_veg!</label>
		</transition>
		<transition id="id203">
			<source ref="id190"/>
			<target ref="id192"/>
			<label kind="guard" x="-110" y="-221">t&gt;=2 &amp;&amp; 
!noVegetablePizza</label>
			<label kind="assignment" x="-110" y="-187">t=0</label>
		</transition>
		<transition id="id204">
			<source ref="id193"/>
			<target ref="id189"/>
			<label kind="guard" x="-722" y="-59">t&gt;=2 &amp;&amp; 
freezer_buffer_count &lt; MAX_PIZZA_BUFFER</label>
			<label kind="assignment" x="-722" y="-76">freezer_buffer_count++</label>
		</transition>
		<transition id="id205">
			<source ref="id191"/>
			<target ref="id189"/>
			<label kind="guard" x="-663" y="-374">t&gt;=2 &amp;&amp; 
oven_buffer_count &lt; MAX_PIZZA_BUFFER</label>
			<label kind="assignment" x="-663" y="-331">oven_buffer_count++</label>
		</transition>
		<transition id="id206">
			<source ref="id190"/>
			<target ref="id193"/>
			<label kind="guard" x="-204" y="-93">noVegetablePizza &amp;&amp; 
!isOven</label>
			<label kind="assignment" x="-204" y="-59">t=0</label>
		</transition>
		<transition id="id207">
			<source ref="id190"/>
			<target ref="id191"/>
			<label kind="guard" x="-204" y="-306">noVegetablePizza &amp;&amp; 
isOven</label>
			<label kind="assignment" x="-204" y="-264">t=0</label>
		</transition>
		<transition id="id208">
			<source ref="id189"/>
			<target ref="id190"/>
			<label kind="guard" x="-501" y="-221">meat_buffer_count &gt; 0</label>
			<label kind="assignment" x="-501" y="-195">t=0, meat_buffer_count--</label>
		</transition>
	</template>
	<system>// Place template instantiations here.
internalGoodsProvider = InternalGoodsProvider();
inventoryManager = InventoryManager();
restockingHandler = RestockingHandler();
freezer = Freezer();
packagingRobot = PackagingRobot();
oven = Oven();
doughMachine = DoughMachine();

// List one or more processes to be composed into a system.
system Customer, freezer, packagingRobot, oven, doughMachine, DoughShaper, SauceMachine, CheeseGrater, VegetablesSlicer, MeatSlicer, InternalGoodsProvider, InventoryManager, RestockingHandler;
</system>
	<queries>
		<option key="--exploration" value="0"/>
		<option key="--backwards-order" value="0"/>
		<option key="--diagnostic" value="0"/>
		<query>
			<formula>A[] not deadlock</formula>
			<comment>Check that the system never deadlocks</comment>
			<result outcome="success" type="quality" timestamp="2025-11-07 16:16:05 +0100">
				<option key="--exploration" value="0"/>
				<option key="--backwards-order" value="0"/>
				<option key="--diagnostic" value="0"/>
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; deadlock</formula>
			<comment/>
			<result outcome="failure" type="quality" timestamp="2025-11-06 23:52:12 +0100">
				<option key="--exploration" value="0"/>
				<option key="--backwards-order" value="0"/>
				<option key="--diagnostic" value="0"/>
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; oven.baking</formula>
			<comment>Check that it's possible to reach the baking state</comment>
			<result outcome="success" type="quality" timestamp="2025-11-06 21:06:51 +0100">
				<option key="--exploration" value="0"/>
				<option key="--backwards-order" value="0"/>
				<option key="--diagnostic" value="0"/>
			</result>
		</query>
		<query>
			<formula>A[] (oven.baking imply temp == TARGET_TEMP)</formula>
			<comment>Check that baking only happens at target temperature</comment>
			<result outcome="success" type="quality" timestamp="2025-11-06 23:59:16 +0100">
				<option key="--exploration" value="0"/>
				<option key="--backwards-order" value="0"/>
				<option key="--diagnostic" value="0"/>
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; packagingRobot.operatePizza</formula>
			<comment>Check that packaging robot can reach dispatching state</comment>
			<result outcome="success" type="quality" timestamp="2025-11-06 23:59:08 +0100">
				<option key="--exploration" value="0"/>
				<option key="--backwards-order" value="0"/>
				<option key="--diagnostic" value="0"/>
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; freezer.freeze</formula>
			<comment>Check that freezer can reach frozen state</comment>
			<result outcome="success" type="quality" timestamp="2025-11-06 23:59:11 +0100">
				<option key="--exploration" value="0"/>
				<option key="--backwards-order" value="0"/>
				<option key="--diagnostic" value="0"/>
			</result>
		</query>
		<query>
			<formula>A[] (stock_level &lt; 0 imply false)</formula>
			<comment>Verify stock never goes negative</comment>
			<result outcome="success" type="quality" timestamp="2025-11-07 17:05:51 +0100">
				<option key="--exploration" value="0"/>
				<option key="--backwards-order" value="0"/>
				<option key="--diagnostic" value="0"/>
			</result>
		</query>
		<query>
			<formula>E&lt;&gt; InternalGoodsProvider.dough_provide</formula>
			<comment>Check that goods can be provided</comment>
			<result outcome="success" type="quality" timestamp="2025-11-07 00:03:49 +0100">
				<option key="--exploration" value="0"/>
				<option key="--backwards-order" value="0"/>
				<option key="--diagnostic" value="0"/>
			</result>
		</query>
	</queries>
</nta>
