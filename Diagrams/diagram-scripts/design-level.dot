digraph "Digital Pizza Factory - Design Level Architecture" {
    rankdir=LR;
    node [shape=record, style=filled, fillcolor=lightgoldenrod1];

    // === Web Interface Layer ===
    subgraph cluster_web {
        label = "Web Interface Layer";
        style=filled;
        color=lightblue;

        CustomerInterfaceSW [label="{CustomerInterfaceSW|<<REST Controller>>\\lFunction: Accepts customer orders\\lEndpoint: /order\\lSignals: OrderRequest:json\\lTiming: <100ms}"];
        EmployeeInterfaceSW [label="{EmployeeInterfaceSW|<<REST Controller>>\\lFunction: Provides dashboard access\\lEndpoint: /dashboard\\lSignals: DashboardAccess:boolean\\lTiming: <100ms}"];
        APIGateway [label="{APIGateway|<<API Gateway>>\\lFunction: Routes requests to Kafka\\lRoutes: /order, /dashboard\\lAdapter: HTTP â†’ Kafka\\lSignals: HTTPRequest:string\\lTiming: <20ms}"];
    }
    

    // === Messaging Layer ===
    subgraph cluster_messaging {
        label = "Messaging Layer";
        style=filled;
        color=lightgreen;

        KafkaBus [label="{KafkaBus|<<Message Broker>>\\lFunction: Event distribution\\lTopics:\\l- order-events\\l- dough-events\\l- sauce-events\\l- topping-events\\l- oven-events\\l- packaging-events\\l- inventory-events\\l- quality-events\\lSignals: EventPayload:json\\lTiming: <10ms}"];
    }
    


    // === Order Processing Controller ===
    subgraph cluster_order {
        label = "Order Processing Controller";
        style=filled;
        color=lightyellow;

        OrderProcessingController [label="{OrderProcessingController|<<Service Controller>>\\lFunction: Orchestrates pizza production\\lReceives validated orders\\lSignals:\\l- OrderID:int\\l- Timestamp:datetime\\lTiming: <50ms}"];

        DoughDispatchService [label="{DoughDispatchService|<<Business Logic>>\\lFunction: Dispatch dough preparation event\\lValidates dough type and weight\\lSignals:\\l- DoughType:string\\l- Weight:float\\lTiming: <40ms}"];

        SauceDispatchService [label="{SauceDispatchService|<<Business Logic>>\\lFunction: Dispatch sauce application event\\lValidates sauce type and volume\\lSignals:\\l- SauceType:string\\l- Volume:float\\lTiming: <30ms}"];

        ToppingDispatchService [label="{ToppingDispatchService|<<Business Logic>>\\lFunction: Dispatch topping application event\\lValidates topping selection and quantity\\lSignals:\\l- ToppingType:string\\l- Quantity:int\\lTiming: <30ms}"];

        OvenDispatchService [label="{OvenDispatchService|<<Business Logic>>\\lFunction: Dispatch baking event\\lSets temperature and duration\\lSignals:\\l- Temperature:int\\l- Duration:int\\lTiming: <60ms}"];
        
        FreezerDispatchService [label="{FreezerDispatchService"];

        PackagingDispatchService [label="{PackagingDispatchService|<<Business Logic>>\\lFunction: Dispatch packaging event\\lDefines packaging type and freezing\\lSignals:\\l- PackagingType:string\\l- Freeze:boolean\\lTiming: <70ms}"];
    }

    // === Production Machines ===
    subgraph cluster_dough {
        label = "Dough Machine";
        style=filled;
        color=lightgray;

        DoughController [label="{DoughController|<<Device Controller>>\\lFunction: Controls dough machine\\lSignals: DoughCommand:string\\lTiming: <40ms}"];
        DoughService [label="{DoughService|<<Business Logic>>\\lFunction: Prepares dough\\lAdapter: RecipeDB\\lSignals:\\l- DoughType:string\\l- Weight:float\\lTiming: <40ms}"];
    }

    subgraph cluster_sauce {
        label = "Sauce Machine";
        style=filled;
        color=lightgray;

        SauceController [label="{SauceController|<<Device Controller>>\\lFunction: Controls sauce dispenser\\lSignals: SauceCommand:string\\lTiming: <30ms}"];
        SauceService [label="{SauceService|<<Business Logic>>\\lFunction: Dispenses sauce\\lAdapter: RecipeDB\\lSignals:\\l- SauceType:string\\l- Volume:float\\lTiming: <30ms}"];
    }

    subgraph cluster_topping {
        label = "Topping Machine (Meat & Vegetables)";
        style=filled;
        color=lightgray;

        ToppingController [label="{ToppingController|<<Device Controller>>\\lFunction: Controls topping applicator\\lSignals: ToppingCommand:string\\lTiming: <30ms}"];
        ToppingService [label="{ToppingService|<<Business Logic>>\\lFunction: Applies toppings\\lAdapter: InventoryDB\\lSignals:\\l- ToppingType:string\\l- Quantity:int\\lTiming: <30ms}"];
    }

    subgraph cluster_oven {
        label = "Oven";
        style=filled;
        color=lightgray;

        OvenController [label="{OvenController|<<Device Controller>>\\lFunction: Controls oven\\lSignals: BakeCommand:string\\lTiming: <60ms}"];
        OvenService [label="{OvenService|<<Business Logic>>\\lFunction: Bakes pizza\\lController: OvenUnit\\lSignals:\\l- Temperature:int\\l- Duration:int\\lTiming: <60ms}"];
    }

    subgraph cluster_freezer {
        label = "Freezer";
        style=filled;
        color=lightgray;

        FreezerController [label="{OvenController|<<Device Controller>>\\lFunction: Controls oven\\lSignals: BakeCommand:string\\lTiming: <60ms}"];
        FreezerService [label="{OvenService|<<Business Logic>>\\lFunction: Bakes pizza\\lController: OvenUnit\\lSignals:\\l- Temperature:int\\l- Duration:int\\lTiming: <60ms}"];
    }
    subgraph cluster_packaging {
        label = "Packaging Machine";
        style=filled;
        color=lightgray;

        PackagingController [label="{PackagingController|<<Device Controller>>\\lFunction: Controls packaging unit\\lSignals: PackCommand:string\\lTiming: <70ms}"];
        PackagingService [label="{PackagingService|<<Business Logic>>\\lFunction: Packages and freezes pizza\\lController: PackagingUnit\\lSignals:\\l- PackagingType:string\\l- Freeze:boolean\\lTiming: <70ms}"];
    }

    subgraph cluster_warehouse {
        label = "Warehouse Services";
        style=filled;
        color=lightgoldenrod2;

        InventoryController [label="{InventoryController|<<Service Controller>>\\lFunction: Monitors stock levels and alerts\\lSignals:\\l- StockLevel:int\\l- Alert:boolean\\lTiming: <100ms}"];
        InventoryService [label="{InventoryService|<<Business Logic>>\\lFunction: Evaluates inventory thresholds\\lTriggers restock or internal supply\\lSignals:\\l- InventoryStatus:string\\l- Threshold:int\\lTiming: <100ms}"];

        RestockingController [label="{RestockingController|<<Service Controller>>\\lFunction: Interfaces with external suppliers\\lSignals:\\l- RestockRequest:string\\lTiming: <80ms}"];
        RestockingService [label="{RestockingService|<<Adapter Service>>\\lFunction: Sends restock requests to SupplierAPI\\lAdapter: SupplierAPI\\lSignals:\\l- ItemID:int\\l- Quantity:int\\lTiming: <80ms}"];

        GoodsProviderController [label="{GoodsProviderController|<<Service Controller>>\\lFunction: Coordinates internal logistics\\lSignals:\\l- SupplyCommand:string\\lTiming: <90ms}"];
        GoodsProviderService [label="{GoodsProviderService|<<Adapter Service>>\\lFunction: Dispatches goods from internal storage\\lAdapter: InternalLogistics\\lSignals: SupplyRequest:string\\lTiming: <90ms}"];
    }



    // === Bidirectional Connections ===
    
    // Web Interface Layer
    CustomerInterfaceSW -> APIGateway [dir=both, label="HTTPS"];
    EmployeeInterfaceSW -> APIGateway [dir=both, label="HTTPS"];
    APIGateway -> KafkaBus [dir=both, label="Events"];

    // Order Processing
    KafkaBus -> OrderProcessingController [dir=both, label="order-events"];
    OrderProcessingController -> DoughDispatchService [dir=both, label="Command"];
    DoughDispatchService -> KafkaBus [dir=both, label="dough-events"];

    OrderProcessingController -> SauceDispatchService [dir=both, label="Command"];
    SauceDispatchService -> KafkaBus [dir=both, label="sauce-events"];

    OrderProcessingController -> ToppingDispatchService [dir=both, label="Command"];
    ToppingDispatchService -> KafkaBus [dir=both, label="topping-events"];

    OrderProcessingController -> OvenDispatchService [dir=both, label="Command"];
    OvenDispatchService -> KafkaBus [dir=both, label="oven-events"];

    OrderProcessingController -> PackagingDispatchService [dir=both, label="Command"];
    PackagingDispatchService -> KafkaBus [dir=both, label="packaging-events"];
    
    OrderProcessingController -> FreezerDispatchService [dir=both, label="Command"];
    FreezerDispatchService -> KafkaBus [dir=both, label="freezer-events"];

    // Production Machines
    KafkaBus -> DoughController [dir=both, label="dough-events"];
    DoughController -> DoughService [dir=both, label="Command/Result"];
    
    KafkaBus -> FreezerController [dir=both, label="freezer-events"];
    FreezerController -> FreezerService [dir=both, label="Command/Result"]

    KafkaBus -> SauceController [dir=both, label="sauce-events"];
    SauceController -> SauceService [dir=both, label="Command/Result"];

    KafkaBus -> ToppingController [dir=both, label="topping-events"];
    ToppingController -> ToppingService [dir=both, label="Command/Result"];

    KafkaBus -> OvenController [dir=both, label="oven-events"];
    OvenController -> OvenService [dir=both, label="Command/Result"];

    KafkaBus -> PackagingController [dir=both, label="packaging-events"];
    PackagingController -> PackagingService [dir=both, label="Command/Result"];

    // Warehouse Services
    KafkaBus -> InventoryController [dir=both, label="inventory-events"];
    InventoryController -> InventoryService [dir=both, label="Evaluate/Result"];
    InventoryService -> KafkaBus [dir=both, label="restock-supply"];

    KafkaBus -> RestockingController [dir=both, label="restock-events"];
    RestockingController -> RestockingService [dir=both, label="Request/Response"];

    KafkaBus -> GoodsProviderController [dir=both, label="supply-events"];
    GoodsProviderController -> GoodsProviderService [dir=both, label="Dispatch/Confirm"];


}